<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Einlandr</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="./apple-touch-icon.png">
    <link rel="icon" type="image/x-icon" href="./favicon.ico">

    <link rel="stylesheet" href="./css/index.css">
  </head>
  <body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <!-- React app is rendered here -->
    <section id="application"></section>

    <script src="./js/app.js"></script>

    
    <script>
      (function () {
        
  var interval;
  var needsReload = false;

  function manageInterval(fn, time) {
    interval && clearInterval(interval);
    interval = setInterval(fn, time);
  }

  function ajax(to, onload) {
    var xhr = new XMLHttpRequest();
    xhr.addEventListener('load', onload);
    xhr.open('GET', to);
    xhr.send();
  }

  function askAboutReload(onsuccess, onfail) {
    ajax(location.protocol + '//' + location.host + '/einlandr-reload', function () {
      if (this.status === 200) {
        onsuccess(this);
      } else {
        onfail(this);
      }
    });
  }

  function checkForLiveServer(onsuccess, onfail) {
    ajax(location.href, function () {
      if (this.status === 200) {
        onsuccess(this);
      } else {
        onfail(this);
      }
    });
  }

  function onLiveServerResponse(xhr) {
    needsReload = false;
    clearInterval(interval);
    location.reload();
  }

  function onLiveServerFail() {
    needsReload = true;
    manageInterval(cycleAjax, 500);
  }

  function onReloadResponse(xhr) {
    if (needsReload || JSON.parse(xhr.responseText).needsReload) {
      needsReload = true;
      checkForLiveServer(onLiveServerResponse, onLiveServerFail);
    }
  }

  function onReloadResponseFail() {
    needsReload = true;
  }

  function cycleAjax() {
    askAboutReload(onReloadResponse, onReloadResponseFail);
  }

  manageInterval(cycleAjax, 3000);

      }())
    </script>
  
  </body>
</html>
